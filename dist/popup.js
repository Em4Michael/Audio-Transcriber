(()=>{let e,t,o,n,r,s=!1;function i(){chrome.storage.local.get(["transcription"],e=>{e.transcription&&e.transcription!==n.textContent&&(n.textContent=e.transcription,console.log("Updated transcription in popup:",e.transcription))})}function d(r){console.error("Error:",r),o.textContent="Error",n.textContent=`Error: ${r}`,chrome.storage.local.set({status:"Error",recording:!1}),e.disabled=!1,t.disabled=!0}document.addEventListener("DOMContentLoaded",()=>{console.log("Popup loaded"),e=document.getElementById("startBtn"),t=document.getElementById("stopBtn"),o=document.getElementById("status"),n=document.getElementById("caption"),r=document.getElementById("toggleBtn"),chrome.storage.local.get(["status","transcription","recording","minimized"],i=>{o.textContent=i.status||"Ready",n.textContent=i.transcription||"",(s=i.minimized||!1)?(document.body.classList.add("minimized"),r.textContent="Restore"):(document.body.classList.remove("minimized"),r.textContent="Minimize"),i.recording?(e.disabled=!0,t.disabled=!1,o.textContent="Capturing..."):(e.disabled=!1,t.disabled=!0,o.textContent=i.status||"Ready")}),e.addEventListener("click",()=>{console.log("Requesting start recording"),o.textContent="Capturing current tab audio...",chrome.runtime.sendMessage({action:"startRecording"},n=>{if(chrome.runtime.lastError){d(`Message error: ${chrome.runtime.lastError.message}`);return}n&&n.success?(console.log("Recording started successfully"),e.disabled=!0,t.disabled=!1,o.textContent="Capturing...",chrome.storage.local.set({recording:!0})):d(`Failed to start recording: ${n?.error||"No response"}`)})}),t.addEventListener("click",()=>{console.log("Requesting stop recording"),chrome.runtime.sendMessage({action:"stopRecording"},n=>{if(chrome.runtime.lastError){d(`Stop error: ${chrome.runtime.lastError.message}`);return}n&&n.success?(console.log("Recording stopped successfully"),e.disabled=!1,t.disabled=!0,o.textContent="Ready",chrome.storage.local.set({recording:!1})):d(`Failed to stop recording: ${n?.error||"No response"}`)})}),r.addEventListener("click",()=>{(s=!s)?(document.body.classList.add("minimized"),r.textContent="Restore"):(document.body.classList.remove("minimized"),r.textContent="Minimize"),chrome.storage.local.set({minimized:s})}),setInterval(i,1e3)})})();